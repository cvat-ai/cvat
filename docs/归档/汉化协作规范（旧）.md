# CODEX（给其他 AI 的汉化协作规范）

> 适用范围：本仓库 `cvat-ui` 前端“硬编码汉化”（不引入 i18n 框架）。
> 目标：在**不改逻辑**的前提下，把用户可见英文替换为中文，并能稳定重建 `cvat_ui` 镜像验证。

## 0. 你要改哪里

- 前端源码：`cvat-ui/src/`
- 重点目录（建议按优先级分批改）：
  1) `cvat-ui/src/components/annotation-page/**`（标注页，最核心）
  2) `cvat-ui/src/components/header/**`（导航/入口）
  3) `cvat-ui/src/components/tasks-page/**`、`create-task-page/**`、`task-page/**`（任务流）
  4) `cvat-ui/src/reducers/notifications-reducer.ts`（通知统一口径）

## 1. 只能改什么（允许范围）

只改“用户可见字符串”，通常是引号里的英文：

- JSX 文本：`<span>Save</span>` → `<span>保存</span>`
- 属性文案：`placeholder="..."`、`title="..."`、`CVATTooltip title="..."`
- 消息文案：`notification.*({ message: '...', description: '...' })`、对象字段里的 `message:` / `description:`
- 条件渲染：`isLoading ? 'Loading...' : 'Submit'`

### 变量占位符必须保留

- 模板字符串：`` `Could not delete task #${taskID}` `` → `` `无法删除任务 #${taskID}` ``
- 花括号占位符：`{count}`、`${name}`、`{{id}}` 等格式都要原样保留
- 链接格式：`[Click here](/invitations)` 只翻译可见文字，保持链接结构与路径不变

## 2. 绝对不能改什么（高风险）

以下任何一条改了，都可能导致构建失败或逻辑错误：

- 变量名、函数名、组件名
- `className`、CSS 选择器、样式文件结构
- `import` / `export` 语句
- API 路径、路由路径、事件名（`onClick`/`onChange` 等）
- 用于逻辑判断的字符串常量（例如 `state === 'new'` 里的 `'new'`）

## 3. 统一译法（要一致）

优先参考 `docs/` 下对照表（尤其是按钮/导航/常见词）。同一英文在不同页面必须保持同一中文译法：

- Projects / Tasks / Jobs / Cloud Storages / Requests / Analytics / Models / Guide
- Label / Labels / Issues / Objects / Filters / Save / Undo / Redo / Search / Create / Delete

## 4. 分派方式（推荐拆包并行）

每个 AI 只负责一个“包”，避免冲突：

- 包 A：`components/annotation-page/**`
- 包 B：`components/header/**` + 顶栏入口相关
- 包 C：`components/tasks-page/**`、`create-task-page/**`、`task-page/**`
- 包 D：`reducers/notifications-reducer.ts`（直接对照 `docs/汉化对照表_01_通知消息.md`）
- 包 E：全局补漏（聚焦 `placeholder=`、`title=`、`message:`、`description:`）

## 5. 提交前自检（每个包都要做）

1) **语法检查**：确认没有引号/反引号不匹配、JSX 标签没破
2) **占位符检查**：`${...}` / `{...}` / `{{...}}` 都还在
3) **不改逻辑检查**：diff 里只出现字符串变化
4) **快速扫漏**（只在自己负责目录内）：
   - 搜索常见英文词：`Save|Cancel|Search|Create|Delete|Loading|Error`
   - 如果命中仍大量存在，确认是否为“用户可见”再决定是否翻译

> 提示：仓库里 `notification.*`、`title=`、`placeholder=`、`message:` 出现非常多，做包 E 的 AI 主要就是兜底这些散落点。

## 6. 汉化后重建与验证（给集成者执行）

注意：仅 `docker-compose.yml` 默认用的是镜像 `cvat/ui:${CVAT_VERSION}`；要触发本地 UI build，必须叠加 `docker-compose.dev.yml`（其中 `cvat_ui` 指定 `Dockerfile.ui`）。

### 推荐命令

```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml build cvat_ui
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d cvat_ui
```

### 验证

- 打开 `http://localhost:8080`
- 强刷：`Ctrl+Shift+R`（或无痕模式）

## 7. 交付格式（发给集成者）

请在消息里按下面格式交付（方便集成/复核）：

1) 你负责的包名：A/B/C/D/E
2) 改动文件列表（路径）
3) 说明是否涉及占位符/链接字符串（有的话，列出你改过的例子）
4) 你自检过的点：语法 / 占位符 / 仅字符串变更

---

## 8. 主代理补充说明（给 CODEX 的重要提醒）

### 8.1 分工调整

原文档分 A-E 五个包，但 `CVAT汉化任务分工.md` 更细致地分成了 **6 个子代理**：

| 子代理 | 负责区域 | 优先级 |
|--------|---------|--------|
| 1 | `annotation-page/` 核心标注界面 | ⭐⭐⭐⭐⭐ |
| 2 | `tasks-page/`、`task-page/`、`create-task-page/` 任务管理 | ⭐⭐⭐⭐ |
| 3 | `projects-page/`、`jobs-page/`、`models-page/`、`requests-page/` 等 | ⭐⭐⭐ |
| 4 | `login-page/`、`register-page/`、`header/`、`organization-page/` 用户认证 | ⭐⭐⭐ |
| 5 | `cloud-storages-page/`、`export-*/`、`import-*/`、`file-manager/` 云存储导入导出 | ⭐⭐ |
| 6 | `common/`、`labels-editor/`、`webhooks-page/`、`quality-control/` 等通用组件 | ⭐⭐ |

**建议按 6 个子代理并行执行**，而不是原来的 5 个包。

### 8.2 必须参考的对照表

每个子代理在汉化前，**必须先读取**对应的对照表文档：

- `汉化对照表_01_通知消息.md` → 子代理 6（或涉及 notification 的任何代理）
- `汉化对照表_02_输入框提示.md` → 所有代理（placeholder 散布各处）
- `汉化对照表_03_工具提示.md` → 所有代理（title/tooltip 散布各处）
- `汉化对照表_04_表单验证和快捷键.md` → 子代理 2、4、6
- `汉化对照表_05_界面静态文本.md` → 所有代理（核心词汇表）

### 8.3 特别注意的高风险点

1. **状态值不能翻译**：
   ```tsx
   // ❌ 错误 - 这是逻辑判断用的，不能改
   state === 'new'
   state === 'completed'

   // ✅ 正确 - 这是显示用的，可以改
   <span>{state === 'new' ? '新建' : '已完成'}</span>
   ```

2. **notification 的 key 不能改**：
   ```tsx
   // ❌ 错误
   notification.error({ 消息: '失败' })

   // ✅ 正确
   notification.error({ message: '失败' })
   ```

3. **模板字符串占位符必须保留**：
   ```tsx
   // ✅ 正确
   `无法删除任务 #${taskID}`
   `默认标签已更改为 "${label.name}"`
   ```

4. **链接格式保持不变**：
   ```tsx
   // ✅ 正确 - 只翻译可见文字，路径不动
   '[点击这里](/invitations)查看详情'
   ```

### 8.4 reducers/notifications-reducer.ts 特殊处理

这个文件集中了大量通知消息，建议单独处理：
- 参考 `汉化对照表_01_通知消息.md`，里面有完整的 100+ 条对照
- 这个文件改动量大，建议作为独立任务

### 8.5 utils/ 目录

`cvat-ui/src/utils/` 下有两个重要文件：
- `validation-rules.ts` - 表单验证消息
- `validation-patterns.ts` - 密码/用户名验证消息

这些在 `汉化对照表_04_表单验证和快捷键.md` 里有完整对照。

### 8.6 我的疑问（需要 CODEX 确认）

1. **作业状态显示**：`new`、`in progress`、`completed`、`rejected` 这些状态在界面上显示时，是直接渲染字符串还是通过映射函数？如果是映射函数，需要找到那个函数来改。

2. **Ant Design 组件**：有些组件如 `Modal.confirm` 的 `okText`/`cancelText` 默认是英文，是否需要全局配置 Ant Design 的 locale？还是逐个改？

3. **快捷键描述**：`汉化对照表_04` 里有大量快捷键描述，这些是否都需要翻译？还是保留英文更好（因为快捷键本身是英文字母）？

---

## 9. 执行前检查清单

每个子代理开始工作前，确认：

- [ ] 已读取 `CODEX_汉化协作规范.md`（本文档）
- [ ] 已读取 `CVAT汉化任务分工.md`（分工和词汇表）
- [ ] 已读取对应的 `汉化对照表_*.md`
- [ ] 明确自己负责的目录范围
- [ ] 不会改动其他子代理负责的目录

