# CVAT 汉化工作总览（开工唯一入口）

目标：将本仓库中 **CVAT UI（`cvat-ui`）与关键后端交互文案**尽可能汉化为中文，保持功能与结构不变；本轮采用“硬编码汉化”，不引入 i18n、不升级依赖、不做大重构。

本目录只保留 3 份“开工必看”文档，其他历史拆分材料已移动到 `docs/归档/`，避免越看越乱。

---

## 1) 你现在要看哪几份（只看这 3 个）

1. `docs/汉化工作总览.md`：本文件（范围/规则/构建/验证/常见坑）
2. `docs/中英对照表.md`：全量“英文 → 中文”统一口径（开工前先统一术语）
3. `docs/遗漏英文清单.md`：自动扫描的“可能残留英文”清单（需智能甄别，不能机械照做）

---

## 2) 汉化范围与优先级（本轮约定）

### 2.1 前端（优先）

- 主目录：`cvat-ui/src/`
- 优先改动类型：按钮/标题/Label/Tooltip/Empty/notification/message 等 **用户可见字符串**

### 2.2 Analytics（单独说明）

CVAT 顶部导航【分析】打开的 `/analytics` **不是 CVAT 前端页面**，而是 **Grafana**（由 `traefik` 转发到 `cvat_grafana`）。

汉化分两层：
- **Grafana 自身 UI**：通过 Grafana 配置决定语言（见第 5 节）
- **CVAT 提供的 dashboard 文本**：在 `components/analytics/grafana/dashboards/*.json` 内（标题/变量/列名等）

### 2.3 后端（可选但已纳入质量门槛）

如果已由其他 AI 批量翻译后端报错/校验提示：只允许改“提示文本”，禁止改接口字段名/枚举值/参数名等机器依赖内容。

---

## 3) 允许改 / 禁止改（硬规则）

### 3.1 允许改（安全）

- JSX 可见文字：`<span>Save</span>` → `<span>保存</span>`
- 属性文案：`label` / `title` / `placeholder` / Tooltip 文案
- `notification.*` / `message.*` / Modal 的 `title/content/okText/cancelText`

### 3.2 必须保留（不可破坏）

- 模板占位符：`${...}`、`{...}`、`{{...}}` 原样保留
- URL/路径/文件名模板：例如 `https://example.com/...`、`backup_{{id}}`
- JSX/HTML 结构与组件 props 结构

### 3.3 禁止改（高风险，容易“看似汉化但逻辑坏了”）

- 变量名/函数名/组件名/类型名
- 枚举值、状态码、权限 codename（机器依赖）
- API path、路由 path、请求字段名/响应 JSON key（如 `detail`）
- `className`、CSS 选择器、样式结构

---

## 4) “遗漏英文清单”要智能分析（不要照单全改）

`docs/遗漏英文清单.md` 里很多条目其实不是“可翻译的固定文本”，常见需要保留的包括：

- 动态数据：`{owner.username}`、`{displayName}`、`${id}` 等
- 日期/数值格式：`dayjs(...).format(...)`
- 枚举/状态来自后端：`{status.status}`、`{dumper.name}`、`{importer.name}`
- 示例值：`manifest.jsonl`、`support@organization.com`、`https://example.com/...`

处理方式：
- 只翻译 **明确的固定英文 UI 文案**
- 不确定的，先在 UI 里复现再决定（最后统一验证）

---

## 5) /analytics（Grafana）中文化要点（本轮已修复）

Grafana 10.1 的默认语言由 `users.default_language` 控制，对应环境变量是：

- `GF_USERS_DEFAULT_LANGUAGE=zh-Hans`

另外，Grafana 以子路径方式部署在 `/analytics/`，需要：

- `GF_SERVER_ROOT_URL=http://${CVAT_HOST:-localhost}:${CVAT_PORT:-8080}/analytics/`
- `GF_SERVER_SERVE_FROM_SUB_PATH=true`

这些配置位于：`docker-compose.yml` 的 `cvat_grafana` 服务。

---

## 6) 构建与验证（一次性闭环）

你希望“最后集体验证”，所以工作节奏建议：

1) 先按 `docs/遗漏英文清单.md` 扫一遍，批量修复“确定能翻译”的固定文案
2) 再统一重建 UI 容器做一轮人工复核
3) 最后补一轮扫漏（notification/title/placeholder）

常用命令（开发态）：

```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml build cvat_ui
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d cvat_ui
```

---

## 7) 给协作 AI 的最短交接（如需并行）

只要他遵守 3 条就不会“翻译翻崩”：

1) 只改用户可见字符串；保留所有 `${...}`/`{...}`/`{{...}}`、URL、结构
2) 新增术语映射必须补进 `docs/中英对照表.md`（防止口径漂移）
3) 改完至少能通过 `yarn run build:cvat-ui`（或在容器里重建通过）

