# 交付与接力指南（给“下一个 AI/接手者”）

本文件目标：让接手者不用问问题就能找到“镜像/启动方式/账号/汉化技能入口/常见坑”。

---

## 1) 当前交付结论（可收尾）

- 已完成 UI 汉化并通过构建与 Docker 运行验证
- 当前本机 Docker 运行正常（`cvat_ui` / `cvat_server` / `traefik` 等均 Up）
- 登录账号已可用：`admin / admin123`
- 开发过程中产生的垃圾文件已清理，并提交了整理 commit

---

## 2) 你要交付到服务器的是什么？

### A. 镜像标签（服务器能直接拉/能直接 build 的场景）

- `cvat/ui:dev`
- `cvat/server:dev`

可在任意机器上确认：
```bash
docker image ls | grep -E '^cvat/(ui|server)\s+dev'
```

### B. 离线镜像文件（服务器不能 build/不能 pull 的场景）

在本机（Windows）把镜像导出为 tar：
```powershell
cd "D:/OneDrive/steven/code/5/cvat-develop"
docker save -o ".local/docker-images/cvat-ui-dev.tar" cvat/ui:dev
docker save -o ".local/docker-images/cvat-server-dev.tar" cvat/server:dev
```

本机输出的绝对路径（本次导出）：
- `D:\OneDrive\steven\code\5\cvat-develop\.local\docker-images\cvat-ui-dev.tar`
- `D:\OneDrive\steven\code\5\cvat-develop\.local\docker-images\cvat-server-dev.tar`

> 注意：`.local/` 在 `.gitignore` 里，tar 不会被提交到 Git。接手者若缺少 tar，需要重新执行 `docker save` 生成。

在服务器导入：
```bash
docker load -i cvat-ui-dev.tar
docker load -i cvat-server-dev.tar
```

---

## 3) 服务器怎么启动（最小流程）

把仓库（或只带 compose 所需文件的发布包）放到服务器上，执行：
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```

检查状态：
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml ps
```

入口：
- Web：`http://<server>:8080`

---

## 4) “完全重置”后为什么不能登录？怎么恢复？

如果执行过：
```bash
docker compose ... down -v
```
数据库会变成空库，默认不会自动创建 `admin`。

创建/重置管理员：
```powershell
cd "D:/OneDrive/steven/code/5/cvat-develop"
docker compose -f docker-compose.yml -f docker-compose.dev.yml exec -T cvat_server python manage.py shell -c "from django.contrib.auth import get_user_model; User=get_user_model(); u,created=User.objects.get_or_create(username='admin', defaults={'email':'admin@localhost','is_staff':True,'is_superuser':True}); u.is_staff=True; u.is_superuser=True; u.set_password('admin123'); u.save(); print('admin:', 'created' if created else 'updated')"
```

---

## 5) 汉化工作流（Lingo skill）怎么一键跑？

这是**全局 skill**（不在仓库内），路径：
- `C:/Users/baba1/.codex/skills/lingo/SKILL.md`

推荐入口（先自检再跑全流程）：
```powershell
pwsh -NoProfile -ExecutionPolicy Bypass -File "C:/Users/baba1/.codex/skills/lingo/scripts/lingo-run.ps1" -ProjectRoot (Get-Location).Path
```

只验证“skill 可用 + BYOK 网关 OK”（不改代码）：
```powershell
pwsh -NoProfile -ExecutionPolicy Bypass -File "C:/Users/baba1/.codex/skills/lingo/scripts/lingo-self-test.ps1" -ProjectRoot (Get-Location).Path
```

如果要“翻译完顺手重建并启动 Docker”：
```powershell
pwsh -NoProfile -ExecutionPolicy Bypass -File "C:/Users/baba1/.codex/skills/lingo/scripts/lingo-run.ps1" -ProjectRoot (Get-Location).Path -DockerRebuild -DockerServices cvat_ui,cvat_server
```

---

## 6) 最常见坑（已修复/已规避）

- Windows CRLF 会导致容器脚本/worker 异常（例如 `python3\r`、`Unexpected worker`）  
  已在 `Dockerfile` 增加容器内 `sed -i 's/\r$//'` 清理：脚本 + `backend_entrypoint.d/*.conf`
- `docker pause` 不释放端口，不能用于“并行占用相同端口的栈”
- `.local/` 下是本机运行与导出产物，默认不入库；交付要用 tar 就重新导出

---

## 7) 文档入口

- 本地 Docker 启动：`docs/使用说明_本地Docker启动与使用.md`
- 标注功能入门：`docs/使用说明_CVAT标注功能入门.md`

